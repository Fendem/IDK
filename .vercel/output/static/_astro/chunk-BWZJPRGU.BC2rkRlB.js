var N=(e,r,n)=>!e&&n?x(n):V(r),x=e=>{const r=e.userId,n=e.user,o=e.sessionId,s=e.session,i=e.organization,t=e.orgId,f=e.orgRole,g=e.orgPermissions,v=e.orgSlug,u=e.actor,l=e.factorVerificationAge;return{userId:r,user:n,sessionId:o,session:s,organization:i,orgId:t,orgRole:f,orgPermissions:g,orgSlug:v,actor:u,factorVerificationAge:l}},V=e=>{const r=e.user?e.user.id:e.user,n=e.user,o=e.session?e.session.id:e.session,s=e.session,i=e.session?e.session.factorVerificationAge:null,t=s?.actor,f=e.organization,g=e.organization?e.organization.id:e.organization,v=f?.slug,u=f&&n?.organizationMemberships?.find(_=>_.organization.id===g),l=u&&u.permissions,p=u&&u.role;return{userId:r,user:n,sessionId:o,session:s,organization:f,orgId:g,orgRole:p,orgSlug:v,orgPermissions:l,actor:t,factorVerificationAge:i}},D="METHOD_CALLED";function C(e,r){return{event:D,payload:{method:e,...r}}}let a=[],d=0;const m=4;let I=0,T=e=>{let r=[],n={get(){return n.lc||n.listen(()=>{})(),n.value},lc:0,listen(o){return n.lc=r.push(o),()=>{for(let i=d+m;i<a.length;)a[i]===o?a.splice(i,m):i+=m;let s=r.indexOf(o);~s&&(r.splice(s,1),--n.lc||n.off())}},notify(o,s){I++;let i=!a.length;for(let t of r)a.push(t,n.value,o,s);if(i){for(d=0;d<a.length;d+=m)a[d](a[d+1],a[d+2],a[d+3]);a.length=0}},off(){},set(o){let s=n.value;s!==o&&(n.value=o,n.notify(s))},subscribe(o){let s=n.listen(o);return o(n.value),s},value:e};return n};const P=5,h=6,E=10;let Q=(e,r,n,o)=>(e.events=e.events||{},e.events[n+E]||(e.events[n+E]=o(s=>{e.events[n].reduceRight((i,t)=>(t(i),i),{shared:{},...s})})),e.events[n]=e.events[n]||[],e.events[n].push(r),()=>{let s=e.events[n],i=s.indexOf(r);s.splice(i,1),s.length||(delete e.events[n],e.events[n+E](),delete e.events[n+E])}),$=1e3,M=(e,r)=>Q(e,o=>{let s=r(o);s&&e.events[h].push(s)},P,o=>{let s=e.listen;e.listen=(...t)=>(!e.lc&&!e.active&&(e.active=!0,o()),s(...t));let i=e.off;return e.events[h]=[],e.off=()=>{i(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let t of e.events[h])t();e.events[h]=[]}},$)},()=>{e.listen=s,e.off=i}}),U=(e,r,n)=>{Array.isArray(e)||(e=[e]);let o,s,i=()=>{if(s===I)return;s=I;let u=e.map(l=>l.get());if(!o||u.some((l,p)=>l!==o[p])){o=u;let l=r(...u);l&&l.then&&l.t?l.then(p=>{o===u&&t.set(p)}):(t.set(l),s=I)}},t=T(void 0),f=t.get;t.get=()=>(i(),f());let g,v=n?()=>{clearTimeout(g),g=setTimeout(i)}:i;return M(t,()=>{let u=e.map(l=>l.listen(v));return i(),()=>{for(let l of u)l()}}),t},c=(e,r)=>U(e,r),F=(e,r)=>U(e,r,!0),O=(e={})=>{let r=T(e);return r.setKey=function(n,o){let s=r.value;typeof o>"u"&&n in r.value?(r.value={...r.value},delete r.value[n],r.notify(s,n)):r.value[n]!==o&&(r.value={...r.value,[n]:o},r.notify(s,n))},r};var z=O({isLoaded:!1,client:void 0,user:void 0,session:void 0,organization:void 0}),H=O(),R=T(null),G=c([z],e=>e.isLoaded),S=F([z,H],(e,r)=>N(e.isLoaded,{session:e.session,user:e.user,organization:e.organization,client:e.client},r)),J=c([S],e=>e.user),W=c([S],e=>e.session),q=c([S],e=>e.organization),L=c([z],e=>e.client),X=c([R],e=>e);c([L],e=>e?.sessions);var Y=c([L],e=>e?.signIn),B=c([L],e=>e?.signUp),A=(e,r)=>{M(e,()=>{R.get()?.telemetry?.record(C(r))})};A(Y,"$signInStore");A(B,"$signUpStore");A(q,"$organizationStore");export{J as $,W as a,G as b,S as c,R as d,z as e,X as f,H as g,N as h};
